<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Chaos Ajax Test Page</title>

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  </head>
  <body>
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12">
          <h2>Chaos Ajax</h2>
          <div class="card">
            <div class="card-header">
              <ul class="nav nav-tabs card-header-tabs" role="tablist">
                <li class="nav-item">
                  <a class="nav-link active" role="tab" href="#default" data-toggle="tab">Default</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" role="tab" href="#advanced" data-toggle="tab">Advanced</a>
                </li>
              </ul>
            </div>
            <div class="card-body">
              <div class="tab-content">
                <div role="tabpanel" class="tab-pane fade in active" id="default">
                  <form>
                    <div class="form-group">
                      <label for="chaos-ajax-probability">Probability</label>
                      <input type="text" class="form-control" id="chaos-ajax-probability" placeholder="Probability" value="0.1">
                    </div>
                    <div class="form-group">
                      <label for="chaos-ajax-status-code">Status</label>
                      <input type="text" class="form-control" id="chaos-ajax-status-code" placeholder="Status code" value="200">
                    </div>
                    <div class="form-group">
                      <label for="chaos-ajax-status-text">Status text</label>
                      <input type="text" class="form-control" id="chaos-ajax-status-text" placeholder="Status text" value="OK">
                    </div>
                    <div class="form-group">
                      <label for="chaos-ajax-response-text">Response text</label>
                      <textarea class="form-control" id="chaos-ajax-response-text">{}</textarea>
                    </div>
                    <button type="submit" id="run-chaos-ajax" class="btn btn-primary">Run it!</button>
                  </form>
                </div>
                <div role="tabpanel" class="tab-pane fade" id="advanced">bbb</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row justify-content-center" style="margin-top: 30px">
        <div class="col-12">
          <h2 id="request">Request</h2>
          <form>
            <div class="form-group">
              <label for="request-url">URL</label>
              <input type="text" class="form-control" id="request-url" placeholder="Enter URL">
            </div>
            <p>Example URLs:</p>
            <ul>
              <li><a href="#request" class="example-link">https://swapi.co/api/people/</a></li>
              <li><a href="#request" class="example-link">https://swapi.co/api/people/1/</a></li>
              <li><a href="#request" class="example-link">https://swapi.co/api/planets/3/</a></li>
            </ul>
            <div class="row">
              <div class="col-6">
                <h4>XHR code:</h4>
<pre><code>
$("#xhr-request").click(function(event) {
  event.preventDefault();
  const url = $("#xhr-url").val();
  $.get(url, function(data) {
    $("#xhr-response").val(JSON.stringify(data));
  });
});
</code></pre>
                <button type="submit" id="xhr-request" class="btn btn-primary">XHR Request</button>
              </div>
              <div class="col-6">
                <h4>Fetch code:</h4>
<pre><code>
$("#xhr-request").click(function(event) {
  event.preventDefault();
  const url = $("#xhr-url").val();
  $.get(url, function(data) {
    $("#xhr-response").val(JSON.stringify(data));
  });
});
</code></pre>
                <button type="submit" id="fetch-request" class="btn btn-primary">Fetch Request</button>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="row justify-content-center" style="margin-top: 30px">
        <div class="col-12">
          <h2>Response</h2>
          <div class="form-group">
            <label for="xhr-response-status-code">Status code</label>
            <input type="text" id="response-status-code" class="form-control">
          </div>
          <div class="form-group">
            <label for="response-status-text">Status text</label>
            <input type="text" id="response-status-text" class="form-control">
          </div>
          <div class="form-group">
            <label for="response-body">Body</label>
            <textarea id="response-body" class="form-control"></textarea>
          </div>
        </div>
      </div>
    </div>
    <script src="../dist/bundle.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script>
      $(document).ready(function() {
        $("#xhr-request").click(function(event) {
          event.preventDefault();
          const url = $("#request-url").val();
          $.get(url, function(data) {
            $("#response-body").val(JSON.stringify(data));
          });
        });
        $("#fetch-request").click(function(event) {
          event.preventDefault();
          const url = $("#request-url").val();
          fetch(url)
            .then(function(response) {
              return new Promise(function(resolve, reject) {
                response.text().then(function(text) {
                  resolve({
                    statusCode: response.status,
                    statusText: response.statusText,
                    data: text,
                  })
                })
              });
            })
            .then(function(response) {
              $("#response-status-code").val(JSON.stringify(response.statusCode));
              $("#response-status-text").val(JSON.stringify(response.statusText));
              $("#response-body").val(JSON.stringify(response.data));
            });
        });
        $("#run-chaos-ajax").click(function(event) {
          event.preventDefault();
          const probability = parseFloat($("#chaos-ajax-probability").val());
          const defaultStatusCode = parseInt($("#chaos-ajax-status-code").val());
          const defaultStatusText = $("#chaos-ajax-status-text").val();
          const defaultResponseText = $("#chaos-ajax-response-text").val();
          chaos({probability: probability, defaultResponse:{status: defaultStatusCode, statusText: defaultStatusText, responseText: defaultResponseText}});
        });
        $(".example-link").click(function() {
          $("#request-url").val($(this).html());
        });
      });
    </script>
  </body>
</html>
